# Инструкция

Существует несколько основных таблиц с которыми придется чаще всего взаимодействовать:
- `cashbox` - настройки по кассе, более подробно по формату можно ознакомиться в [настройках](../settings.md)
- `account` - управление связкой мерчанта, его магазина и кассы
- `cashreg_delivery` - данные по чекам и их состоянию
- `cashreg_status` - справочная информация по статусам чеков (sent, done и т.д.)
- `type_operation` - справочная информация по типам операции (debit, credit и т.д.)


### cashbox

Название | Описание | Пример
------------ | ------------- | -------------
**name** | Название провайдера | businessru
**settings** | Настройки ККТ в формате json | {}
**url** | Путь к адаптеру | http://adapter-starrys:8022/kkt
**comment** | Комментарий для кассы | Тестовая касса бизнес.ру


### account

Название | Описание | Пример
------------ | ------------- | -------------
**merchant_id** | Идентификатор мерчанта (party_id) | 81550185-ae82-43a6-9aed-8a96128ee09a
**shop_id** | Идентификатор магазина мерчанта | 6e53b8f5-5ed1-4e72-9f64-8dd915044a20
**is_active** | Включена отправка чеков или выключена | true
**cashbox_id** | ID кассы из таблицы `cashbox` | 1
**comment** | Комментарий по мерчанту и магазину | Фирма Рога и Копыта, благотворительность


### cashreg_delivery

Название | Описание | Пример
------------ | ------------- | -------------
**invoice_id** | Идентификатор инвойса | 1
**payment_id** | Идентификатор платежа | 1
**refund_id** | Идентификатор возврата | 1
**type_operation** | Тип операции | debit
**request_id** | Идентификатор запроса в кассу | zYRgQ3kOsC-1-debit_test
**cashreg_status** | статус чека | done, sent и т.д.
**cashreg_uuid** | Идентификатор для запроса статуса чека при асинхронном взаимодействии | 958f4851-13c2-422f-a673-3c96b65777e8
**cashreg_response** | Ответ от кассы или описание ошибки | <200 OK,ReportResponse{uuid='958f4851-13c
**cart_state** | Состояние корзины | full, partial


В случае ошибки `cashreg_status` может находится в 2 вариантах:

`error` - сбой сети, недоступность кассы и т.д.
- Если есть `cashreg_uuid`, то мы уже получили ответ от кассы и теперь надо лишь запросить статус повторно, перевести в статус `sent`
- В другом случае, надо заново отправить запрос с тем же идентификатором, для этого надо перевести в статус `ready_to_send`
 
 
`fail` - касса по какой-то причине не приняла чек и нужно будет разобраться почему и переотправить
- Например, какая-то ошибка в корзине. Можно будет поправить корзину и изменить статус, чтобы отправить повторно.
