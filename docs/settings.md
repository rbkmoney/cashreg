# Настройки

### Формат настроек KKT заполняются в виде JSON-а

Название | Описание | Пример
------------ | ------------- | -------------
**url** | URL к ККТ | https://fce.cashreg.ru:4443/fr/api/v2/
**group** | Определяет в какой группе должно находиться устройство для отправки запроса | GROUP0
**login** | Логин | login
**pass** | Пароль | pass
**client_id** | идентификатор точки продажи, если одно устройство обслуживает разные точки продажи | ""
**tax_id** | Налог на добавленную стоимость (НДС) | 1
**tax_mode** | Режим налогообложения | "osn"
**inn** | ИНН | "7750005700"
**company_name** | Название компании | Рога И Копыта
**company_address** | Название компании | г. Москва, ул. Оранжевая, д.22 к.11
**company_email** | e-mail компании | horns@hooves.ru
**key** | Код агента | "1234567"
**payment_method** | Признак способа расчёта | full_prepayment, prepayment, advance and etc
**payment_object** | Признак предмета расчёта | commodity, job, service and etc
**private_key** | Приватный ключ для подписи запросов | 
**cert** | Сертификат | cashreg.p12


`group` - идентификатор группы ККТ

`login` - логин пользователя для отправки данных. Логин для отправки данных можно получить из файла настроек для CMS в личном кабинете пользователя

`pass` - пароль пользователя для отправки данных. Пароль для отправки данных можно получить из файла настроек для CMS в личном кабинете пользователя.

`tax_id` - Устанавливает номер налога в ККТ. Перечисление со значениями:
 - «none» – без НДС;
 - «vat0» – НДС по ставке 0%;
 - «vat10» – НДС чека по ставке 10%;
 - «vat18» – НДС чека по ставке 18%;
 - «vat20» – НДС чека по ставке 20%;
 - «vat110» – НДС чека по расчетной ставке 10/110;
 - «vat118» – НДС чека по расчетной ставке 18/118.
 - «vat120» – НДС чека по расчетной ставке 20/120.
 
`tax_mode` - Система налогообложения. Перечисление со значениями:
 - «osn» – общая СН;
 - «usn_income» – упрощенная СН (доходы);
 - «usn_income_outcome» – упрощенная СН (доходы минус расходы);
 - «envd» – единый налог на вмененный доход;
 - «esn» – единый сельскохозяйственный налог;
 - «patent» – патентная СН.
 
`payment_method` - Признак способа расчёта
 - «full_prepayment» – предоплата 100%. Полная предварительная оплата до момента передачи предмета расчета.
 - «prepayment» – предоплата. Частичная предварительная оплата до момента передачи предмета расчета.
 - «advance» – аванс.
 - «full_payment» – полный расчет. Полная оплата, в том числе с учетом аванса (предварительной оплаты) в момент передачи предмета расчета.
 - «partial_payment» – частичный расчет и кредит. Частичная оплата предмета расчета в момент его передачи с последующей оплатой в кредит.
 - «credit» – передача в кредит. Передача предмета расчета без его оплаты в момент его передачи с последующей оплатой в кредит.
 - «credit_payment» – оплата кредита. Оплата предмета расчета после его передачи с оплатой в кредит (оплата кредита).

`payment_object` - Признак предмета расчёта
 - «commodity» – товар. О реализуемом товаре, за исключением подакцизного товара (наименование и иные сведения, описывающие товар).
 - «excise» – подакцизный товар. О реализуемом подакцизном товаре (наименование и иные сведения, описывающие товар).
 - «job» – работа. О выполняемой работе (наименование и иные сведения, описывающие работу).
 - «service» – услуга. Об оказываемой услуге (наименование и иные сведения, описывающие услугу).
 - «gambling_bet» – ставка азартной игры. О приеме ставок при осуществлении деятельности по проведению азартных игр.
 - «gambling_prize» – выигрыш азартной игры. О выплате денежных средств в виде выигрыша при осуществлении деятельности по проведению азартных игр.
 - «lottery» – лотерейный билет. О приеме денежных средств при реализации лотерейных билетов, электронных лотерейных билетов, приеме лотерейных ставок при осуществлении деятельности по проведению лотерей.
 - «lottery_prize» – выигрыш лотереи. О выплате денежных средств в виде выигрыша при осуществлении деятельности по проведению лотерей.
 - «intellectual_activity» – предоставление результатов интеллектуальной деятельности. О предоставлении прав на использование результатов интеллектуальной деятельности или средств индивидуализации.
 - «payment» – платеж. Об авансе, задатке, предоплате, кредите, взносе в счет оплаты, пени, штрафе, вознаграждении, бонусе и ином аналогичном предмете расчета.
 - «agent_commission» – агентское вознаграждение. О вознаграждении пользователя, являющегося платежным агентом (субагентом), банковским платежным агентом (субагентом), комиссионером, поверенным или иным агентом.
 - «composite» – составной предмет расчета. О предмете расчета, состоящем из предметов, каждому из которых может быть присвоено значение выше перечисленных признаков.
 - «another» – иной предмет расчета. О предмете расчета, не относящемуся к выше перечисленным предметам расчета.
 - «property_right» – имущественное право. О передаче имущественных прав.
 - «non-operating_gain» – внереализационный доход. О внереализационном доходе.
 - «insurance_premium» – страховые взносы. О суммах расходов, уменьшающих сумму налога (авансовых платежей) в соответствии с пунктом 3.1 статьи 346.21 Налогового кодекса Российской Федерации.
 - «sales_tax» – торговый сбор. О суммах уплаченного торгового сбора.
 - «resort_fee» – курортный сбор. О курортном сборе.



### Настройки для работы с базой данных

Название | Описание | Пример
------------ | ------------- | -------------
**spring.datasource.url** | путь к базе данных | jdbc:postgresql://127.0.0.1:5432/cashreg
**spring.datasource.username** | логин | username
**spring.datasource.password** | пароль | password
**spring.flyway.schemas** | схема | cashreg


#### Общие настройки приложения

Данные для работы с приложением

Название | Описание | Пример
------------ | ------------- | -------------
**cron.expression.debit** | Крон для отправки чеков для Прихода | 60000 (milliseconds)
**cron.expression.refund_debit** | Крон для отправки чеков для Возврата Прихода | 60000 (milliseconds)
**cron.expression.status** | Крон для запроса статуса чеков | 60000 (milliseconds)
**query.limit.debit** | Лимит выборки из базы для чеков Прихода | 30
**query.limit.refund_debit** | Лимит выборки из базы для чеков Возврата Прихода | 30
**query.limit.status** | Лимит выборки из базы для чеков по запросу статуса | 30
**polling.limit.timeout** | Лимит для таймаута по запросу статуса (в минутах) | 60
**caffeine.expire_after_write** | Лимит, после которого запись в кэше протухнет (в минутах) | 90
**caffeine.maximum_size** | Максимальный размер кэша | 1000


### BusterMaze (тут уже поллинг из кафки)

[Сервис сохранения информации о состоянии системы](https://github.com/rbkmoney/bustermaze)

Название | Описание | Пример
------------ | ------------- | -------------
**bm.pooling.url** | URL к BusterMaze-у | http://bm:8022/repo




#### Дополнительная информация

### Данные в корзине должны заполняться в формате согласно документации в swagger-е

```
{  
   "shopID":"TEST",
   "amount":21260,
   "currency":"RUB",
   "dueDate":"2017-08-15T11:52:18Z",
   "product":"product",
   "description":"Заказ №1074 на сайте rbkmoney.myinsales.ru",
   "cart":[  
      {  
         "product":"Samsung Galaxy Tab 2 7.0 P3100 8Gb",
         "quantity":1,
         "price":1260
      },
      {  
         "product":"Курьером (Доставка курьером в пределах МКАД)",
         "quantity":1,
         "price":20000,
         "taxMode":{  
            "type":"InvoiceLineTaxVAT",
            "rate":"18%"
         }
      }
   ]
}
```

Если товар "Без НДС", то `taxMode` не передается


### Требования к CAPI

Когда приходят данные по инвойсу в `Details/Cart/Lines`,
то ожидаю в поле `metadata` по ключу `TaxMode` строковое значение msgpack (напр. "18%").
